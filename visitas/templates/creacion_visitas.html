{% extends 'base.html' %}
{% block title %}ADEL | agregar visita{% endblock %}

{% block body %}
<body onload="set_initial_date()">    
{% load staticfiles %}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="{% static '/static/js/generic/calendarios.js'%}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/visitas/creacion.visitas.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/generic/table.css' %}"/>

<div class = "header">
  <span class="header_text">Agregar una visita</span>
  <img src="{% static 'img/iconos/visitas40.png' %}" alt="ups">
</div>

<section class="seccion_errores" id="seccion_errores">   
    <h4 class="errores_h4">Corrige los siguientes errores</h4> 
    <p class="errores_p" id="error_paciente">Paciente - <label>{{ form.paciente.errors.as_text }}</label></p>
    <p class="errores_p" id="error_divisa">Divisa - <label>{{ form.dolares.errors.as_text }}</label></p>
    <p class="errores_p" id="error_tipo_pago">Tipo de pago - <label>{{ form.tipo_pago.errors.as_text }}</label></p>
    <p class="errores_p" id="error_dentista">Dentista - <label>{{ form.dentista.errors.as_text }}</label></p>
    <p class="errores_p" id="error_dolares">Dolares - <label>{{ form.dolares.errors.as_text }}</label></p> 
</section>

<section class="seccion_formulario">
    <form method=post>
    {% csrf_token %}
    <div class="seccion_1">
        <div class="select">
            <label class="label-formularios">{{ form.paciente.label}}</label>
            {{ form.paciente }}       
        </div><br>
        <div class="motivo">
            <label class="label-formularios">{{ form.motivo.label}}</label>
            {{ form.motivo }}
        </div>

    </div>

    <div class="seccion_2">
        <table style="width: 99%;">
            <tbody>      
            <tr class="generic-tr">
                <td class="td-left"><label class="label-formularios">Dentista que atendio</label></td>
                <td class="td-right">{{ form.dentista }}  </td>
            </tr>
            <tr class="generic-tr">
                <td class="td-left"><label class="label-formularios">{{ form.tipo_pago.label}}</label></td>
                <td class="td-right">{{ form.tipo_pago }}  </td>
            </tr>
            <tr class="generic-tr">
                <td class="td-left"><label class="label-formularios">{{ form.precio.label }}</label></td>
                <td class="td-right">{{ form.precio }}</td>
            </tr>
            <tr class="generic-tr">
                <td class="td-left"><label class="label-formularios">{{ form.dolares.label}}</label></td>
                <td class="td-right">{{ form.dolares }}  </td>
            </tr>
            <tr class="generic-tr">
                <td class="td-left"><label class="label-formularios">{{ form.fecha_visita.label}}</label></td>
                <td class="td-right">{{ form.fecha_visita }}
                    <select name = "hora" id="hora" onchange="set_date()">
                        <option value="00:00">Hora</option>
                        <option name = "hora" id="hora" value="08:00">08:00</option>
                        <option name = "hora" id="hora" value="08:30">08:30</option>
                        <option name = "hora" id="hora" value="09:00">09:00</option>
                        <option name = "hora" id="hora" value="09:30">09:30</option>
                        <option name = "hora" id="hora" value="10:00">10:00</option>
                        <option name = "hora" id="hora" value="10:30">10:30</option>
                        <option name = "hora" id="hora" value="11:00">11:00</option>
                        <option name = "hora" id="hora" value="11:30">11:30</option>
                        <option name = "hora" id="hora" value="12:00">12:00</option>
                        <option name = "hora" id="hora" value="12:30">12:30</option>
                        <option name = "hora" id="hora" value="13:00">13:00</option>
                        <option name = "hora" id="hora" value="13:30">13:30</option>
                        <option name = "hora" id="hora" value="14:00">14:00</option>
                        <option name = "hora" id="hora" value="14:30">14:30</option>
                        <option name = "hora" id="hora" value="15:00">15:00</option>
                        <option name = "hora" id="hora" value="15:30">15:30</option>
                        <option name = "hora" id="hora" value="16:00">16:00</option>
                        <option name = "hora" id="hora" value="16:30">16:30</option>
                        <option name = "hora" id="hora" value="17:00">17:00</option>
                        <option name = "hora" id="hora" value="17:30">17:30</option>
                        <option name = "hora" id="hora" value="18:00">18:00</option>
                        <option name = "hora" id="hora" value="18:30">18:30</option>
                        <option name = "hora" id="hora" value="19:00">19:00</option>
                        <option name = "hora" id="hora" value="19:30">19:30</option>
                        <option name = "hora" id="hora" value="20:00">20:00</option>
                        <option name = "hora" id="hora" value="20:30">20:30</option>
                    </select>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="seccion_botones">           
        <input class="btn btn-success boton_1" id="save_contact" 
        type="submit" onclick="set_empty_values()" value="Registrar"/>
        <a href="/lista.visitas" class="btn btn-default boton_2">Volver</a>
    </div>
    </form>
</section>


<script>
    function set_initial_date(){
        var fecha = document.getElementById('datepicker');
        if (fecha.value.length == 0){
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();

        if(dd<10) {
            dd = '0'+dd 
        } 
        if(mm<10) {
            mm = '0'+mm
        } 

        today = yyyy + '-' + mm + '-' + dd;
        fecha.value = today;
        }
    }
    function set_date(){
        var fecha = document.getElementById('datepicker');
        var hora = document.getElementById('hora');

        if (fecha.value.length > 10){  
            if (hora.value != "00:00"){
                fecha.value = fecha.value.substring(0,10);
                fecha.value = fecha.value + " " + hora.value;
            }else {
            fecha.value = fecha.value.substring(0,10);    
            }
           
        }else{
            fecha.value = fecha.value + " " + hora.value;
        }
    }
    function set_empty_values(){
    motivo = document.getElementById('id_motivo');
    precio = document.getElementById('id_precio');

    if (motivo.value == ""){
        motivo.value = "No especificado";
        }
    if (precio.value == ""){
        precio.value = 0;
        }
    console.log('entre show errors');
    seccion_errores = document.getElementById('seccion_errores');
    paciente = document.getElementById('error_paciente');
    paciente_label = paciente.children("label:first").value;
    
    paciente.children('input').each(function () {
    alert(this.value); // "this" is the current element in the loop
    });
    console.log(paciente);
    console.log(paciente_label);
    // if (paciente_label.length>=1 ){
    //     seccion_errores.style.display = "block";
    //     paciente.style.display="block";
    //     }
    //     else{
    //     seccion_errores.style.display = "block";
    //     paciente.style.display = "block";
    //     }
  }
</script>

</body>
{% endblock %}
